# Kubernetes Multi-Node Cluster Setup with Kubeadm\n\nThis guide outlines the steps to set up a multi-node Kubernetes cluster using Kubeadm.\n\n## Prerequisites (on all nodes: control-plane and worker)\n\n1.  **Operating System**: A compatible Linux host (e.g., Ubuntu, CentOS, RHEL).\n2.  **Hardware**: 2 GB or more of RAM per machine (any less will leave little room for your apps).\n3.  **Network Connectivity**: Full network connectivity between all machines in the cluster.\n4.  **Unique Hostname**: A unique hostname, MAC address, and product_uuid for every node.\n5.  **Swap Disabled**: Disable swap memory.\n6.  **Container Runtime**: Install a container runtime (e.g., Docker, containerd).\n7.  **kubeadm, kubelet, and kubectl**: Install these Kubernetes tools.\n\n### Step 1: Disable Swap\n\nRun the following commands on **all nodes** (control-plane and worker) to disable swap:\n\n```bash\nsudo swapoff -a\nsudo sed -i \'/ swap / s/^\(.*\)$/#\\1/g\' /etc/fstab\n```\n\n### Step 2: Install Container Runtime (Docker)\n\nRun the following commands on **all nodes** to install Docker:\n\n```bash\nsudo apt-get update\nsudo apt-get install -y ca-certificates curl gnupg\nsudo install -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\nsudo chmod a+r /etc/apt/keyrings/docker.gpg\necho \\\n  "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n  "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" | \\\n  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\nsudo apt-get update\nsudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\nsudo systemctl enable docker\nsudo systemctl start docker\n```\n\n### Step 3: Install kubeadm, kubelet, and kubectl\n\nRun the following commands on **all nodes** to install kubeadm, kubelet, and kubectl. This assumes you are on a Debian-based system (like Ubuntu).\n\n```bash\nsudo apt-get update\nsudo apt-get install -y apt-transport-https ca-certificates curl\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\necho \'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /\' | sudo tee /etc/apt/sources.list.d/kubernetes.list\nsudo apt-get update\nsudo apt-get install -y kubelet kubeadm kubectl\nsudo apt-mark hold kubelet kubeadm kubectl\n```\n\n### Step 4: Configure Containerd for Kubernetes\n\nKubeadm has certain requirements for containerd, specifically that the `systemd` cgroup driver is used. Run the following commands on **all nodes**:\n\n```bash\nsudo mkdir -p /etc/containerd\ncontainerd config default | sudo tee /etc/containerd/config.toml\nsudo sed -i \'s/SystemdCgroup = false/SystemdCgroup = true/g\' /etc/containerd/config.toml\nsudo systemctl restart containerd\n```\n\n## Control-Plane Node Setup\n\n### Step 5: Initialize the Control-Plane Node\n\nChoose one node to be your control-plane node. Run the following command on the **control-plane node only**. Replace `<YOUR_CONTROL_PLANE_IP>` with the actual IP address of your control-plane node.\n\n```bash\nsudo kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=<YOUR_CONTROL_PLANE_IP>\n```\n\nAfter `kubeadm init` completes, it will output commands to set up `kubectl` for a non-root user and the `kubeadm join` command for worker nodes. Make sure to save the `kubeadm join` command.\n\n### Step 6: Configure kubectl\n\nAs a regular user, run the following commands on the **control-plane node only** to configure `kubectl`:\n\n```bash\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n### Step 7: Deploy a Pod Network Add-on (Flannel)\n\nRun the following command on the **control-plane node only** to deploy Flannel (a common choice for pod networking):\n\n```bash\nkubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml\n```\n\n### Step 8: Verify Control-Plane Node Status\n\nRun the following command on the **control-plane node only** to check if the control-plane node is ready:\n\n```bash\nkubectl get nodes\n```\n\nIt might take a few moments for the status to change to `Ready`.\n\n## Worker Node Setup\n\n### Step 9: Join Worker Nodes to the Cluster\n\nOn each **worker node**, run the `kubeadm join` command that was outputted during the `kubeadm init` step on the control-plane node. It will look something like this:\n\n```bash\nsudo kubeadm join <YOUR_CONTROL_PLANE_IP>:6443 --token <token> --discovery-token-ca-cert-hash sha256:<hash>\n```\n\nReplace `<YOUR_CONTROL_PLANE_IP>`, `<token>`, and `<hash>` with the actual values you received from the control-plane node\'s `kubeadm init` output.\n\n### Step 10: Verify Worker Node Status\n\nOn the **control-plane node**, run the following command to check if the worker nodes have joined and are `Ready`:\n\n```bash\nkubectl get nodes\n``` 